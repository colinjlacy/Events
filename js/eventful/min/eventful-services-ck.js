angular.module("eventfulServices",[]).factory("eventfulServices",function(e){return{findEvents:function(t,n,s){var r=[],a=t?t:new Date,i=a.toISOString().slice(0,10),s=s?s:1,o=n?n:a.addDays(30);o=o.toISOString().slice(0,10);var v=function(e){var t=e.split("-"),n=t.join("");return n};i=v(i),o=v(o);var c=["neverUsed","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return e({url:"server/call.php?date_start="+i+"00&date_stop="+o+"00&page="+s,method:"GET"}).success(function(e){console.log(e);for(var t=0;t<e.events.event.length;t++){e.events.event[t].year=e.events.event[t].start_time.substring(0,4);var n=e.events.event[t].start_time.substring(5,7);"0"==n.substr(0,1)&&(n=n.substr(1,1)),e.events.event[t].month=c[n],e.events.event[t].day=e.events.event[t].start_time.substring(8,10),e.events.event[t].description&&(e.events.event[t].description=e.events.event[t].description.replace(/(<([^>]+)>)/gi," ").trim()),r.push(e.events.event[t]),console.log(e.events.event[t])}}),r},postToCal:function(t,n,s){var r=encodeURIComponent(t.calendar.id),a=t.start_time.slice(0,10),i=t.stop_time?t.stop_time.slice(0,10):a,o=t.title,v=t.description+" View the event description on Eventful:"+t.url,c=t.venue_name,l=[];if(s)for(var u=0;u<s.length;u++)l.push({email:s[u].email});e({url:"https://www.googleapis.com/calendar/v3/calendars/"+r+"/events?sendNotifications=true&key=185024779579-go9t2i4b44oaffv6as49ijotubekkcql.apps.googleusercontent.com&access_token="+n,method:"POST",data:{start:{date:a},end:{date:i},location:c,summary:o,description:v,attendees:l}})}}});